## 存储过程
一组可编程的函数，是为了完成特定功能的SQL语句集，经编译创建并保存在数据库中，用户可通过指定存储过程的名字并给定参数(需要时)来调用执行。
https://www.cnblogs.com/geaozhang/p/6797357.html



## 索引类型

主键、联合索引(最左匹配原则、区分度大的放在前面、可以做覆盖索引优化)、普通索引、唯一索引、



聚簇索引 非聚簇索引


b+树：叶子节点在同一层，组成双向链表

b+树：索引最好时自增的，防止乱序插入到b+数，导致大量页分类和自平衡。

b+数非叶子节点不存数据，相比b树可以索引查找时候的磁盘查询次数。



## 事务

ACID 原子 一致 隔离 持久。

- A通过 undolog实现，记录旧值，方便回滚
- D通过 redolog实现，REDO LOG记录了事务对数据库所做的所有修改，以便在系统崩溃或介质故障后能够重新执行这些修改，从而恢复数据的一致性
- I通过 MVCC实现。

ADI -> c




MVCC版本控制：

默认实现了可重复度隔离级别。

通过版本链来控制多个事务访问同一条记录。 每条记录拥有trxid，表示修改自己的事务id。还拥有一个通过undolog建立的版本链。

select开始前创建一个readview，包含当前未提交的事务id。

可重复度情况下，如果当前行的trxid < readview最小id，则可以读取。否则通过版本链读取下一个trx进行比较。

## 锁

innodb支持 行锁 表锁

update是行锁

metadata是表锁










## 主从架构

### 问题
因为更新主节点的表时，发生了metadatalock，进而导致主节点cpu 100%，变为不可用状态。可优化操作

- 故障切换到从节点
- 从节点更新后替换为主节点。
- 读写分离，写主节点，读从节点。


### 主从同步

slave节点会新建专门的I/O线程，读取master节点的binlog，并在本地进行回放。达到主从同步的目的。

延迟无法避免，不必要使用读写分离时，直接读写主节点，从节点用于备份和故障切换。


## 性能

单点mysql并发连接高cpu高，考虑分库，或者读写分离（多节点读）

单表的数据超过了千万级别，大表查询更新慢，考虑分表，减少锁冲突

查询速度慢：

- explain至少做到 ref（非唯一索引）或者eq_ref（唯一索引）以上。all和index都是全表扫描。
- 避免使用select * 使用覆盖索引
- 加入redis缓存