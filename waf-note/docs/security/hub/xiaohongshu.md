背景

WAF用户在开启多种引擎防护时，RS中是依次串行调用开启的引擎，在压力过大或者引擎较多时，可能会出现超时，从而造成攻击请求漏拦。

方案

方案1：修改RS中的逻辑，从原有的串行修改为并行。（RS为NGINX+LUA架构），优点：修改lua逻辑即可 缺点：性能较差



方案2：引入一个新的组件解决并发的问题，RS调用该组件即可。即HUB。优点：利用go的协程天然并发实现新组件，且可以推动引擎使用rpc协议，提升协议层的性能 缺点：需要实现新组件，且请求多跳。



经过demo测试，在同等的并发条件下，方案2的性能数据优于方案1，所以需要实现hub，进而推动引擎的架构统一，协议优化

HUB的目标

在安全场景下，请求检查多安全引擎时，使用并发能力，提升在指定时间内获取引擎结果的能力。

HUB架构

hub在WAF中位于RS和引擎之间，提供并发查询引擎能力。


