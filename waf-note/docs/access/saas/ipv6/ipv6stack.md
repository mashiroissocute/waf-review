
### ipv6地址优势

- ipv6作为ipv4的扩展，传输层和应用层基本不需要改变，就能使用ipv6协议。
- IPv6 具有128bit地址，可以解决ipv4地址耗尽的问题。
- IPv6 是固定报头，不像 IPv4 那样携带一堆冗长的数据，简短的报头提升了网络数据转发的效率。
- IPv6 的路由表更小，聚合能力更强，保证了数据转发的路径更短，极大的提高了转发效率。
- IPsec 在 IPv4 协议中并没有强制使用 IPSec加密数据，导致网站明文传输泄漏数据，而 IPv6 则是直接集成了 IPSec，在网络层认证与加密数据，为用户提供端到端的数据安全，保证数据不被劫持。

### ipv6地址格式
`2001:0db8:86a3:08d3:1319:8a2e:0370:7344` 是一个合法的IPv6地址。类似于IPv4的点分十进制，同样也存在点分十六进制的写法，将8组4位十六进制地址的冒号去除后，每位以点号“.”分组，例如： `2001:0db8:85a3:08d3:1319:8a2e:0370:7344` 则记为 `2.0.0.1.0.d.b.8.8.5.a.3.0.8.d.3.1.3.1.9.8.a.2.e.0.3.7.0.7.3.4.4`。
**同时IPv6在某些条件下可以省略**：

- 1.每项数字前导的0可以省略，省略后前导数字仍是0则继续，例如下组IPv6是等价的:
```
2001:**0**db8:**0**2de:**0000**:**0000**:**0000**:**0000**:**0**e13
2001:db8:2de:**0000**:**0000**:**0000**:**0000**:e13
2001:db8:2de:**000**:**000**:**000**:**000**:e13
2001:db8:2de:**00**:**00**:**00**:**00**:e13
2001:db8:2de:**0**:**0**:**0**:**0**:e13
```
- 2.可以用双冒号“::”表示一组0或多组连续的0，**但只能出现一次**：
如果四组数字都是零，可以被省略。遵照以上省略规则，下面这两组IPv6都是相等的。
```
2001:db8:2de:**0**:**0**:**0**:**0**:e13
2001:db8:2de**::**e13

2001:0db8:0000:0000:0000:0000:1428:57ab
2001:0db8:0000:0000:0000::1428:57ab
2001:0db8:0:0:0:0:1428:57ab
2001:0db8:0::0:1428:57ab
2001:0db8::1428:57ab
```
因为双冒号出现了两次，2001**::**25de**::**cade 是非法的。它有可能是下种情形之一，造成无法推断。
```
2001:0000:0000:0000:0000:25de:0000:cade
2001:0000:0000:0000:25de:0000:0000:cade
2001:0000:0000:25de:0000:0000:0000:cade
2001:0000:25de:0000:0000:0000:0000:cade
```
- 3.如果这个地址实际上是IPv4的地址，后32位可以用10进制数表示；因此::ffff:192.168.89.9 相等于::ffff:c0a8:5909。::ffff:1.2.3.4 格式叫做**IPv4映射地址**。IPv4位址可以很容易的转化为IPv6格式。举例来说，如果IPv4的一个地址为135.75.43.52（十六进制为0x874B2B34），它可以被转化为0000:0000:0000:0000:0000:FFFF:874B:2B34 或者::FFFF:874B:2B34。同时，还可以使用混合符号（IPv4-compatible address），则地址可以为::ffff:135.75.43.52。


### ipv6转换机制
IPv6 在 1992 年被提出，到现在已经二十多年，IPv6 技术的发展已经很成熟，那么 IPv4 能否一下全部切换到 IPv6 呢，答案肯定是否定的。主要因为 IPv6 不是 IPv4 的改进，IPv6 是一个全新的协议，**在链路层是不同的网络协议**，不能直接进行通信。而且目前几乎都是在使用 IPv4，所以这种转换可能会持续很久。在IPv6完全取代IPv4前，需要一些转换机制使得只支持IPv6的主机可以连接IPv4服务，并且允许孤立的IPv6主机及网络可以借由IPv4设施连接IPv6互联网。

在IPv6主机和路由器与IPv4系统共存的时期，存在一些转换机制来进行互联网转换。

- 1.双栈技术：采用该技术的节点上同时运行IPv4和IPv6两套协议栈，并且具有ipv4和ipv6地址。这是使IPv6节点保持与纯IPv4节点兼容最直接的方式，针对的对象是通信端节点（包括主机、路由器）。
优势： 这种方式对IPv4和IPv6提供了完全的兼容。
劣势： 对于IP地址耗尽的问题却没有任何帮助。由于需要双路由基础设施，这种方式反而增加了网络的复杂度。

- 2.隧道技术：隧道技术指将另外一个协议数据包的报头直接封装在原数据包报头前，从而可以实现在不同协议的网络上直接进行传输，这种机制用来在 IPv4 网络之上连接 IPv6 的站点，站点可以是一台主机，也可以是多个主机。隧道技术将 IPv6 的分组封装到 IPv4 的分组中，或者把 IPv4 的分组封装到 IPv6 的分组中，封装后的 IPv4 分组将通过 IPv4 的路由体系传输或者 IPv6 的分组进行传输。
优势： 容易实现，只要在隧道的入口和出口进行修改。
劣势： 隧道需要进行封装解封装，转发效率低。 无法解决 IPv4 短缺问题。

- NAT-PT技术：网络地址转换（NAT）技术是将IPv4地址和IPv6地址分别看作内部地址和全局地址，或者相反。例如，内部的IPv4主机要和外部的IPv6主机通信时，在NAT服务器中将IPv4地址（相当于内部地址）变换成IPv6地址（相当于全局地址），服务器维护一个IPv4与IPv6地址的映射表。PT就是在做IPv4/IPv6地址转换(NAT)的同时在IPv4分组和IPv6分组之间进行报头和语义的翻译。
优势：容易实现，只要在Nat的入口和出口进行修改。
劣势：需要维护一个IPv4与IPv6地址的映射表。


### linux网络通信原理

- SOCKET通信：
https://blog.csdn.net/Dandelion_gong/article/details/51602209
- linux提供的网络通信相关的API（系统调用）
https://codeantenna.com/a/knhm3HcItr
- 基于epoll模型的socket通信：
https://learnku.com/articles/41814
- ipv4与ipv6兼容SOCKET编程：
![enter image description here](/tencent/api/attachments/s3/url?attachmentid=4872931)
https://blog.csdn.net/zyz770834013/article/details/71486228?spm=1001.2101.3001.6650.6&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EOPENSEARCH%7Edefault-6.no_search_link&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EOPENSEARCH%7Edefault-6.no_search_link
- PING6的底层实现：
https://www.cnblogs.com/qcloud1001/p/12202988.html




### 路由
路由器接受到ip报文之后，如何根据ipv4或ipv6地转发
#### ipv4和ipv6路由的区别
在无类域间路由 (Classless Inter-Domain Routing, CIDR) 情况下，IPv6 中的路由与 IPv4 路由几乎完全相同。唯一的区别在于地址是 128 位 IPv6 地址，而非 32 位 IPv4 地址。通过非常简单的扩展，所有的 IPv4 路由算法，如 OSPF（开放式最短路径优先）、RIP（路由信息协议）、IDRP（域间路由协议）和 IS-IS（中间系统对中间系统），都可以用来路由 IPv6。
IPv6 还包括可支持功能强大的新路由功能的简单路由扩展。以下是对新路由功能的描述：

- 基于策略、性能、成本等因素选择提供器
- 主机灵活性，可路由到当前位置
- 自动重新寻址，可路由到新地址

https://cloud.tencent.com/developer/article/1671821